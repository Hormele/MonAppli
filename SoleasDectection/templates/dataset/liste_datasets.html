{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>Liste des datasets</h1>
<p>Visualisez, filtrez et gérez vos fichiers de datasets.</p>

<a href="{% url 'uploader_dataset' %}" class="btn btn-success mb-4">+ Uploader un nouveau dataset</a>

<hr>

<h2>Statistiques des datasets</h2>
<canvas id="datasetChart" width="500" height="200"></canvas>

<hr>

<h2>Filtres</h2>
<form method="get" class="form-inline mb-4">
  <label class="mr-2">Type :</label>
  <select name="type" class="form-control mr-3">
    <option value="">Tous</option>
    <option value="brut">Brut</option>
    <option value="nettoye">Nettoyé</option>
  </select>

  <label class="mr-2">Format :</label>
  <select name="format" class="form-control mr-3">
    <option value="">Tous</option>
    <option value="csv">CSV</option>
    <option value="json">JSON</option>
  </select>

  <button type="submit" class="btn btn-primary">Filtrer</button>
</form>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Nom</th>
      <th>Type</th>
      <th>Format</th>
      <th>Date</th>
      <th>Fichier</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for dataset in datasets %}
    <tr>
      <td>{{ dataset.nom }}</td>
      <td>{{ dataset.type }}</td>
      <td>{{ dataset.format }}</td>
      <td>{{ dataset.date|date:"d/m/Y" }}</td>
      <td>
        {% if dataset.fichier %}
          <a href="{{ dataset.fichier.url }}">Télécharger</a>
        {% else %}
          Aucun fichier
        {% endif %}
      </td>
      <td>
        <a href="{% url 'supprimer_dataset' dataset.id %}" class="btn btn-sm btn-danger">Supprimer</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="6">Aucun dataset trouvé.</td></tr>
    {% endfor %}
  </tbody>
</table>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
var ctx = document.getElementById('datasetChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Brut', 'Nettoyé'],
        datasets: [{
            label: 'Nombre de datasets',
            data: [{{ brut_count }}, {{ nettoye_count }}],
            backgroundColor: ['grey', 'green']
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                precision: 0
            }
        }
    }
});
</script>
{% endblock %}
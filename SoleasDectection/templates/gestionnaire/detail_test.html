{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Détail de la Campagne_Test - {{ fichier.id }}</title>
    <link rel="stylesheet" href="{% static 'css/detail_test.css' %}">
</head>
<body>
    <div class="sidebar">
        <h2>SoleasDetection</h2>
        <ul>
            <li><a href="{% url 'dashboard_admin' %}" class="active">Tableau de bord Admin</a></li>
            <li><a href="{% url 'dashboard_accueil' %}">Accueil</a></li>
            <li><a href="{% url 'liste_campagnes' %}">Campagnes</a></li>
            <li><a href="{% url 'liste_datasets' %}">Datasets</a></li>
            <li><a href="{% url 'liste_utilisateurs' %}">Utilisateurs</a></li>
            <li><a href="{% url 'liste_modeles' %}">Modèles ML</a></li>
            <li><a href="{% url 'liste_campagne_test' %}">Campagne Test</a></li>
            <li><a href="{% url 'gestionnaire_regles_metier' %}">Gerer les regles metiers</a></li>
            <li><a href="{% url 'dashboard_gestionnaire' %}">Gestionnaire</a></li>
            <li><a href="{% url 'logout' %}">Déconnexion</a></li>
        </ul>
    </div>

    <div class="main-content">
        <h1>Détail de la Campagne_Test #{{ fichier.id }}</h1>

        {% if erreur %}
            <p class="error">{{ erreur }}</p>
        {% endif %}

        {% if message %}
            <p class="message">{{ message }}
        {% endif %} 

        <form method="get" class="filters">
            <label for="decision">Filtrer par décision :</label>
            <select name="decision" id="decision">
                <option value="">-- Toutes --</option>
                <option value="suspect" {% if filtre_decision == 'suspect' %}selected{% endif %}>Suspect</option>
                <option value="legitime" {% if filtre_decision == 'legitime' %}selected{% endif %}>Légitime</option>
                <option value="en_attente" {% if filtre_decision == 'en_attente' %}selected{% endif %}>En attente</option>
            </select>

            <label for="date">Filtrer par date :</label>
            <input type="date" name="date" value="{{ filtre_date }}">

            <button type="submit">Filtrer</button>
        </form>

        <form method="post">
            {% csrf_token %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>User ID</th>
                        <th>Nom</th>
                        <th>Matricule</th>
                        <th>Fraude</th>
                        <th>Description</th>
                        <th>Décision</th>
                    </tr>
                </thead>
                <tbody>
                    {% for suspect in suspects %}
                    <tr>
                        <td>{{ suspect.id }}</td>
                        <td>{{ suspect.user_id }}</td>
                        <td>{{ suspect.username_y }}</td>
                        <td>{{ suspect.matricule_y }}</td>
                        <td>{{ suspect.is_fraud }}</td>
                        <td>{{ suspect.description }}</td>
                        <td>
                            <select name="decision_{{ suspect.id }}">
                                <option value="suspect" {% if suspect.decision == 'suspect' %}selected{% endif %}>Suspect</option>
                                <option value="legitime" {% if suspect.decision == 'legitime' %}selected{% endif %}>Légitime</option>
                                <option value="en_attente" {% if suspect.decision == 'en_attente' %}selected{% endif %}>En attente</option>
                            </select>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="7">Aucun suspect détecté.</td></tr>
                    {% endfor %}
                </tbody>
            </table>

            {% if suspects %}
            <div class="center">
                <a href="{% url 'generer_rapport_test_pdf' fichier.id %}" class="btn-pdf">Générer le rapport PDF</a>
                <button type="submit" class="btn btn-succes">Valider les decisions</button>
            </div>
            {% endif %}
        </form>
    </div>

    <footer>
        <p>&copy; 2025 SoleasDetection</p>
    </footer>
</body>
</html>
{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Liste des modèles ML</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/liste_modeles.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
</head>
<body>

<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <h2>SoleasDetection</h2>
        <ul>
            <li><a href="{% url 'dashboard_accueil' %}">Accueil</a></li>
            <li><a href="{% url 'liste_modeles' %}" class="active">Modèles ML</a></li>
            <li><a href="{% url 'liste_campagne_test' %}">Campagne Test</a></li>
            <li><a href="{% url 'liste_campagnes' %}">Campagnes</a></li>
            <li><a href="{% url 'liste_datasets' %}">Datasets</a></li>
            <li><a href="{% url 'liste_utilisateurs' %}">Utilisateurs</a></li>
            <li><a href="{% url 'dashboard_gestionnaire' %}">Gestionnaire</a></li>
            <li><a href="{% url 'logout' %}">Déconnexion</a></li>
    </aside>

    <!-- Contenu principal -->
    <main class="main-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">Liste des modèles ML</h1>
            <div class="action-buttons">
                <a href="{% url 'entrainer_modele' %}" class="btn btn-success">+ Entraîner</a>
            </div>
        </div>

        <!-- Formulaires de filtre -->
        <form method="GET" class="filtre-form mb-4 d-flex flex-wrap align-items-end gap-3">
            <div>
                <label for="algo" class="form-label">Filtrer par algorithme :</label>
                <select name="algo" id="algo" class="form-select">
                    <option value="">-- Tous --</option>
                    <option value="isolation_forest">Isolation Forest</option>
                    <option value="svm">SVM</option>
                    <option value="kmeans">K-Means</option>
                </select>
            </div>

            <div>
                <label for="date" class="form-label">Filtrer par date :</label>
                <input type="date" name="date" id="date" class="form-control">
            </div>

            <div>
                <button type="submit" class="btn btn-primary mt-2">Filtrer</button>
            </div>
        </form>

        <!-- Tableau des modèles -->
        <h2 class="mt-4">Tableau des modèles</h2>
        <table class="table table-bordered table-hover mt-3">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Algorithme</th>
                    <th>Type de fraude</th>
                    <th>Date</th>
                    <th>Fichier</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for modele in modeles %}
                <tr>
                    <td>{{ modele.id }}</td>
                    <td>{{ modele.nom }}</td>
                    <td>{{ modele.algorithme }}</td>
                    <td>{{ modele.type_fraude }}</td>
                    <td>{{ modele.date_creation }}</td>
                    <td>
                        {% if modele.fichier_modele %}
                            <a href="{{ modele.fichier_modele.url }}">Télécharger</a>
                        {% else %}
                            Aucun
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'supprimer_modele' modele.id %}" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce test ?');">Supprimer</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Statistiques (graphes) -->
        <h2 class="mt-5">Statistiques des modèles</h2>
        <div class="charts-container" style="display: flex; gap: 30px; flex-wrap: wrap;">
            <canvas id="algoChart" width="400" height="250"></canvas>
            <canvas id="fraudeChart" width="400" height="250"></canvas>
        </div>
    </main>
</div>

<!-- Footer -->
<footer class="footer">
    <p>&copy; 2025 SoleasDetection - Tous droits réservés.</p>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const algoCtx = document.getElementById("algoChart").getContext("2d");
    new Chart(algoCtx, {
        type: 'bar',
        data: {
            labels: {{ algo_labels|safe }},
            datasets: [{
                label: "Nombre de modèles",
                data: {{ algo_data|safe }},
                backgroundColor: "steelblue"
            }]
        }
    });

    const fraudeCtx = document.getElementById("fraudeChart").getContext("2d");
    new Chart(fraudeCtx, {
        type: 'bar',
        data: {
            labels: {{ fraude_labels|safe }},
            datasets: [{
                label: "Par type de fraude",
                data: {{ fraude_data|safe }},
                backgroundColor: "orange"
            }]
        }
    });
</script>

</body>
</html>